<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Saira+Semi+Condensed:wght@100;200;300;400;500;600;700;800;900&family=Space+Grotesk:wght@300..700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles/styles.css" />
    <title>bitbytebit.inc</title>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const year = document.querySelector("#yearUpd");
        // get current year
        const currentYr = new Date().getFullYear();

        year.textContent = currentYr;

        // signin or publish button area
        const fixedButton = document.getElementById("fixed-button");

        async function isUserLoggedIn() {
          const token = localStorage.getItem("authToken");
          if (!token) return false;

          try {
            const response = await fetch("/api/auth/verifyToken", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ token }),
            });
            const data = await response.json();
            if (!data.valid) {
              localStorage.removeItem("authToken");
              return false;
            }
            return true;
          } catch (error) {
            console.error("Err verifying token:", error);
            localStorage.removeItem("authToken");
            return false;
          }
        }

        fixedButton.addEventListener("click", async function (event) {
          event.preventDefault();

          const isLoggedIn = await isUserLoggedIn();
          console.log("User logged in:", isLoggedIn);
          if (await isUserLoggedIn()) {
            window.location.href = "/publishBlog";
          } else {
            window.location.href = "/signin";
          }
        });
      });
    </script>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="logo">
          <h2>bitbytebit.inc</h2>
        </div>
        <div class="nav-icon" id="menu-icon">
          <img src="./assets/images/menu.svg" alt="" />
        </div>
      </div>
    </header>

    <nav id="nav-menu" class="hidden">
      <img
        src="./assets/images/close.svg"
        alt="close"
        id="close-btn"
        class="close-btn"
      />
      <div class="my-nav-area">
        <div class="search-container">
          <input type="text" placeholder="SEARCH..." class="search-input" />
          <img src="./assets/images/search.svg" alt="search" id="search-icon" />
        </div>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/publishBlog">Admin: Publish</a></li>
        </ul>
        <!-- <img src="./assets/images/github.svg" alt="github-logo"> -->
      </div>
    </nav>
    <main>
      <section>
        <div id="largearea"></div>
      </section>
      <section id="recent_blogs">
        <div class="recents">
          <h2>Read Recent Blogs</h2>
          <a class="view-btn" href="/view-all-blog">View all posts</a>
        </div>
      </section>
      <section id="grid-container"></section>
    </main>
    <div class="view">
      <a class="view-all" href="/view-all-blog">View all...</a>
    </div>
    <div class="fixed-buttons">
      <a id="fixed-button" href="#"
        ><img src="./assets/images/add.svg" class="floating-menu"
      /></a>
    </div>
    <footer>
      <p>Â©<span id="yearUpd"></span> bitbytebit.inc All Rights Reserved</p>
    </footer>
  </body>
  <script src="./scripts/script.js" async></script>
  <script defer src="./scripts/menu.script.js"></script>
</html>
